<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Domain Specific Exceptions - Py DDD CQRS Microservice Boilerplate</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Domain Specific Exceptions";
        var mkdocs_page_input_path = "adr/practices/002-Domain Specific Exceptions.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Py DDD CQRS Microservice Boilerplate
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../Architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../Responsibilities/">Responsibilities</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Design Decisions</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../ADRs/">ADRs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Technologies</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../technologies/000-FastAPI/">Fast API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../technologies/001-Pydantic/">Pydantic</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Practices</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../000-Readiness%20probe/">Readiness Probe</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../001-Dependency%20inversion/">Dependency Inversion</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Domain Specific Exceptions</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Py DDD CQRS Microservice Boilerplate</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Design Decisions &raquo;</li>
          <li>Practices &raquo;</li>
      <li>Domain Specific Exceptions</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="use-domain-specific-exceptions">Use Domain Specific Exceptions</h1>
<h1 id="status">Status</h1>
<p>approved</p>
<h1 id="context">Context</h1>
<p>As in life, also when developing APIs things do not always go as planned :)
In such cases there are several approaches to handle failures in a function.</p>
<p>Some of these are:</p>
<ul>
<li>Return objects</li>
<li>Return None</li>
<li>Raise exceptions</li>
</ul>
<p>There's no such thing as the right or wrong approach, and the discussion on using or not exceptions went so far that is
honestly impossible to declare a "clear winner" in the industry.</p>
<p>My personal opinion (and approach) is to:</p>
<ol>
<li>Use exceptions when things do not go as planned</li>
<li>Wrap every "expected" exception with Domain Specific Exceptions</li>
<li>Use the <code>raise ... from e</code> functionality in python to carry the entire stack of exceptions</li>
<li>Allow "unexpected" exceptions to bubble up</li>
<li>DO NOT use wide exception handling, let the webserver throw a 500, get notified for unhandled exceptions<ol>
<li>if the error should be "expected" create a Domain Specific Exception for it</li>
<li>If not then the problem is somewhere else in the architecture, let it be unhandled, the code should fail fast and
   scream loud.</li>
</ol>
</li>
</ol>
<h1 id="decision">Decision</h1>
<p>Use Domain Specific Exceptions, wrap all the expected cases, let the other exceptions bubble up and wrap them when
encountered.</p>
<h1 id="example">Example</h1>
<p>Let's suppose to have the following:</p>
<pre><code class="language-python">
class PetNotFoundError(Exception):
    pass


def get_pet_from_db(pet_id: UUID) -&gt; Pet:
    try:
        return db.query(Pet).get(id=pet_id)
    except mydblibrary.errors.RowNotFoundError as e:
        raise PetNotFoundError() from e
</code></pre>
<p><code>PetNotFoundError</code> is the Domain Specific Exception, it represents what happened in the domain, and has no connection
with any specific technology.
<code>mydblibrary.errors.RowNotFoundError</code> is the "expected" technology specific exception.
Let's now imagine the usage of this function from the api.</p>
<pre><code class="language-python">@app.get(&quot;/pet/{pet_id}&quot;)
def get_pet_api(pet_id: UUID) -&gt; Dict:
    try:
        pet = get_pet_from_db(pet_id)
    except PetNotFoundError as e:
        return HttpResponse(f&quot;Pet {pet_id} was not found&quot;, status_code=404)

    return HttpResponse(to_json(pet), status_code=200)
</code></pre>
<p>Now let's suppose to receive an "unexpected" <code>mydblibrary.errors.ConnectionFailedError</code>, in this
scenario <code>get_pet_from_db</code> will fail and whoever is using it will receive the <code>ConnectionFailedError</code>.
In the case of the API use a mechanism to respond with a 500 to this exception, set in place a mechanism to notify the
team when this happens and approach the situation as follows.</p>
<p>If the problem is due to some temporary problem, solve that problem and let the api fail fast and notify the team.
If instead is an error that should be "expected", create another Domain Specific Exception and handle the error with a
consistent return code.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../001-Dependency%20inversion/" class="btn btn-neutral float-left" title="Dependency Inversion"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../001-Dependency%20inversion/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
